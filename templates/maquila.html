<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Maquila</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS propio -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand fw-bold">MONBLEU ‚Äì Maquila</span>
    <div>
        <a href="/" class="btn btn-outline-light btn-sm me-2">Stock</a>
        <a href="/logout" class="btn btn-outline-light btn-sm">Salir</a>
    </div>
</nav>

<div class="container mt-4">

    <h4 class="mb-3">üè≠ Registrar productos enviados</h4>

    <form method="post">
        <table class="table table-bordered table-sm align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th>Producto</th>
                    <th>Talla</th>
                    <th>Stock</th>
                    <th>Orden pendiente</th>
                    <th>Env√≠o</th>
                </tr>
            </thead>
            <tbody>
                {% for i in data %}
                <!-- üîπ FUNCIONALIDAD AGREGADA (NO se elimina nada) -->
                <tr class="text-center"
                    style="cursor:pointer"
                    onmouseover="hoverFila(this)"
                    onmouseout="unhoverFila(this)"
                    onclick="toggleFila(this)">
                    
                    <td class="text-start fw-semibold">{{ i.producto }}</td>
                    <td>{{ i.talla }}</td>
                    <td class="fw-bold {{ color_stock(i.stock, i.minimos, i.en_produccion) }}">
                        {{ i.stock }}
                    </td>
                    <td class="fw-bold text-warning">{{ i.en_produccion }}</td>
                    <td>
                        <input
                            type="number"
                            name="envio_{{ i.id }}"
                            class="form-control form-control-sm text-center"
                            min="0"
                            max="{{ i.en_produccion }}"
                            placeholder="0"
                            onclick="event.stopPropagation()"
                            oninput="autoSeleccion(this)">
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <button class="btn btn-success">
            üì¶ Registrar env√≠os
        </button>
    </form>

    <hr class="my-4">

    <h4 class="mb-3">üìÑ √ìrdenes de compra ‚Äì Maquila</h4>

    <table class="table table-sm table-striped">
        <thead class="table-dark">
            <tr>
                <th>Fecha</th>
                <th>Total</th>
                <th>Abonado</th>
                <th>Saldo</th>
                <th>PDF</th>
            </tr>
        </thead>
        <tbody>
            {% for o in ordenes %}
            <tr>
                <td>{{ o.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>${{ "%.2f"|format(o.total) }}</td>
                <td>${{ "%.2f"|format(o.abonado) }}</td>
                <td class="fw-bold text-danger">${{ "%.2f"|format(o.saldo) }}</td>
                <td>
                    {% if o.pdf %}
                        <a href="/pdf/{{ o.pdf }}" target="_blank">üìÑ Ver</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<!-- ‚úÖ SCRIPT PURO (SIN TOCAR CSS) -->
<script>
function hoverFila(fila) {
    if (fila.dataset.sel !== "1") {
        fila.style.backgroundColor = "#e9ecef"; // hover gris
    }
}

function unhoverFila(fila) {
    if (fila.dataset.sel !== "1") {
        fila.style.backgroundColor = "";
    }
}

function toggleFila(fila) {
    if (fila.dataset.sel === "1") {
        fila.dataset.sel = "0";
        fila.style.backgroundColor = "";
    } else {
        fila.dataset.sel = "1";
        fila.style.backgroundColor = "#cfe2ff"; // azul seleccionado
    }
}

function autoSeleccion(input) {
    const fila = input.closest("tr");
    if (parseInt(input.value) > 0) {
        fila.dataset.sel = "1";
        fila.style.backgroundColor = "#cfe2ff";
    } else {
        fila.dataset.sel = "0";
        fila.style.backgroundColor = "";
    }
}
</script>

</body>
</html>
