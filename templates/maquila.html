<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Maquila</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS propio -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand fw-bold">MONBLEU ‚Äì Maquila</span>
    <div>
        <a href="/" class="btn btn-outline-light btn-sm me-2">Stock</a>
        <a href="/logout" class="btn btn-outline-light btn-sm">Salir</a>
    </div>
</nav>

<div class="container mt-4">

    <h4 class="mb-3">üè≠ Registrar productos enviados</h4>

    <form method="post">
        <table class="table table-bordered table-sm align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th>Producto</th>
                    <th>Talla</th>
                    <th>Stock</th>
                    <th>Orden pendiente</th>
                    <th>Env√≠o</th>
                </tr>
            </thead>
            <tbody>
                {% for i in data %}
                <!-- ‚úÖ CLASE AGREGADA -->
                <tr class="text-center fila-click">
                    
                    <td class="text-start fw-semibold">{{ i.producto }}</td>
                    <td>{{ i.talla }}</td>
                    <td class="fw-bold {{ color_stock(i.stock, i.minimos, i.en_produccion) }}">
                        {{ i.stock }}
                    </td>
                    <td class="fw-bold text-warning">{{ i.en_produccion }}</td>
                    <td>
                        <input
                            type="number"
                            name="envio_{{ i.id }}"
                            class="form-control form-control-sm text-center"
                            min="0"
                            max="{{ i.en_produccion }}"
                            placeholder="0">
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <button class="btn btn-success">
            üì¶ Registrar env√≠os
        </button>
    </form>

    <hr class="my-4">

    <h4 class="mb-3">üìÑ √ìrdenes de compra ‚Äì Maquila</h4>

    <table class="table table-sm table-striped">
        <thead class="table-dark">
            <tr>
                <th>Fecha</th>
                <th>Total</th>
                <th>Abonado</th>
                <th>Saldo</th>
                <th>PDF</th>
            </tr>
        </thead>
        <tbody>
            {% for o in ordenes %}
            <tr>
                <td>{{ o.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>${{ "%.2f"|format(o.total) }}</td>
                <td>${{ "%.2f"|format(o.abonado) }}</td>
                <td class="fw-bold text-danger">${{ "%.2f"|format(o.saldo) }}</td>
                <td>
                    {% if o.pdf %}
                        <a href="/pdf/{{ o.pdf }}" target="_blank">üìÑ Ver</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<!-- ‚úÖ SCRIPT FUNCIONAL (BOOTSTRAP SAFE) -->
<script>
document.addEventListener('DOMContentLoaded', () => {

    document.querySelectorAll('.fila-click').forEach(fila => {

        fila.style.cursor = 'pointer';
        const celdas = fila.querySelectorAll('td');

        // HOVER
        fila.addEventListener('mouseenter', () => {
            if (fila.dataset.sel !== '1') {
                celdas.forEach(td => {
                    td.style.setProperty(
                        'background-color',
                        '#e3f2fd',
                        'important'
                    );
                });
            }
        });

        fila.addEventListener('mouseleave', () => {
            if (fila.dataset.sel !== '1') {
                celdas.forEach(td => td.style.backgroundColor = '');
            }
        });

        // CLICK
        fila.addEventListener('click', (e) => {
            if (e.target.tagName === 'INPUT') return;

            fila.dataset.sel === '1'
                ? desmarcar(fila)
                : marcar(fila);
        });

        // INPUT AUTO-SELECCI√ìN
        const input = fila.querySelector('input[type="number"]');
        if (input) {
            input.addEventListener('input', () => {
                parseInt(input.value) > 0
                    ? marcar(fila)
                    : desmarcar(fila);
            });
        }
    });

    function marcar(fila) {
        fila.dataset.sel = '1';
        fila.querySelectorAll('td').forEach(td => {
            td.style.setProperty(
                'background-color',
                '#bbdefb',
                'important'
            );
            td.style.textDecoration = 'underline';
        });
    }

    function desmarcar(fila) {
        fila.dataset.sel = '0';
        fila.querySelectorAll('td').forEach(td => {
            td.style.backgroundColor = '';
            td.style.textDecoration = '';
        });
    }

});
</script>

</body>
</html>
