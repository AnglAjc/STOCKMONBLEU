<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Administrador</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS propio -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand fw-bold">MONBLEU ‚Äì Administraci√≥n</span>
    <div>
        <a href="/" class="btn btn-outline-light btn-sm me-2">Stock</a>
        <a href="/logout" class="btn btn-outline-light btn-sm">Salir</a>
    </div>
</nav>

<div class="container mt-4">

    <!-- ================= PRODUCTOS BAJO M√çNIMO ================= -->
    <h4 class="mb-3">üìâ Productos bajo m√≠nimo</h4>

    {% if data %}
    <form method="post">
        <table class="table table-bordered table-sm align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th>Producto</th>
                    <th>Talla</th>
                    <th>Stock</th>
                    <th>M√≠nimo</th>
                    <th>En producci√≥n</th>
                </tr>
            </thead>
            <tbody>
                {% for i in data %}
                <tr class="text-center">
                    <td class="text-start fw-semibold">{{ i.producto }}</td>
                    <td>{{ i.talla }}</td>
                    <td class="fw-bold text-danger">{{ i.stock }}</td>
                    <td>{{ i.minimos }}</td>
                    <td>
                        <input
                            type="number"
                            class="form-control form-control-sm text-center"
                            name="produccion_{{ i.id }}"
                            value="{{ i.en_produccion }}"
                            min="0"
                        >
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <button class="btn btn-primary">
            üíæ Actualizar producci√≥n
        </button>
    </form>
    {% else %}
        <div class="alert alert-success">
            ‚úî No hay productos bajo m√≠nimo
        </div>
    {% endif %}

    <hr class="my-4">

    <!-- ================= √ìRDENES DE COMPRA ================= -->
    <h4 class="mb-3">üßæ √ìrdenes de compra</h4>

    <!-- MAQUILA A -->
    <div class="card mb-4">
        <div class="card-header fw-bold">
            Maquila A ‚Äî Playeras, Pantalones y Hoodies
        </div>
        <div class="card-body">

            {% if ordenes_maquila_a %}
            <table class="table table-sm table-bordered align-middle">
                <thead class="table-light text-center">
                    <tr>
                        <th>Producto</th>
                        <th>Talla</th>
                        <th>Cantidad ordenada</th>
                    </tr>
                </thead>
                <tbody>
                    {% for o in ordenes_maquila_a %}
                    <tr class="text-center">
                        <td class="text-start">{{ o.producto }}</td>
                        <td>{{ o.talla }}</td>
                        <td class="fw-bold">{{ o.cantidad }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <a href="/generar-pdf/maquila-a" class="btn btn-outline-primary btn-sm">
                üìÑ Generar PDF Maquila A
            </a>

            {% else %}
                <p class="text-muted">No hay √≥rdenes pendientes.</p>
            {% endif %}
        </div>
    </div>

    <!-- MAQUILA B -->
    <div class="card mb-4">
        <div class="card-header fw-bold">
            Maquila B ‚Äî Otros productos
        </div>
        <div class="card-body">

            {% if ordenes_maquila_b %}
            <table class="table table-sm table-bordered align-middle">
                <thead class="table-light text-center">
                    <tr>
                        <th>Producto</th>
                        <th>Talla</th>
                        <th>Cantidad ordenada</th>
                    </tr>
                </thead>
                <tbody>
                    {% for o in ordenes_maquila_b %}
                    <tr class="text-center">
                        <td class="text-start">{{ o.producto }}</td>
                        <td>{{ o.talla }}</td>
                        <td class="fw-bold">{{ o.cantidad }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <a href="/generar-pdf/maquila-b" class="btn btn-outline-primary btn-sm">
                üìÑ Generar PDF Maquila B
            </a>

            {% else %}
                <p class="text-muted">No hay √≥rdenes pendientes.</p>
            {% endif %}
        </div>
    </div>

    <!-- ================= HISTORIAL PDF ================= -->
    <h5 class="mt-4">üìÅ Historial de PDFs generados</h5>

    {% if pdfs_generados %}
    <table class="table table-sm table-striped">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Maquila</th>
                <th>Archivo</th>
            </tr>
        </thead>
        <tbody>
            {% for p in pdfs_generados %}
            <tr>
                <td>{{ p.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>{{ p.maquila }}</td>
                <td>
                    <a href="{{ p.ruta }}" target="_blank">
                        {{ p.nombre }}
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="text-muted">No hay PDFs generados.</p>
    {% endif %}

    <hr class="my-4">

    <!-- ================= √öLTIMOS ENV√çOS ================= -->
    <h5>üì¶ √öltimos env√≠os registrados</h5>

    {% if envios %}
    <table class="table table-sm table-striped">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Producto</th>
                <th>Talla</th>
                <th>Cantidad enviada</th>
            </tr>
        </thead>
        <tbody>
            {% for e in envios %}
            <tr>
                <td>{{ e.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>{{ e.producto }}</td>
                <td>{{ e.talla }}</td>
                <td class="fw-bold">{{ e.cantidad }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="text-muted">No hay env√≠os registrados.</p>
    {% endif %}

</div>

</body>
</html>
